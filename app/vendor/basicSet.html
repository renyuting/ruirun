<!doctype html>
<html>
<head>
<title>好吃佬</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-touch-fullscreen" content="YES">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0">
<meta name="HandheldFriendly" content="true"/>
<meta name="MobileOptimized" content="320"/>
<meta name="format-detection" content="telephone=no" />
<link rel="stylesheet" href="css/mui.picker.all.css" type="text/css" media="screen" />
<link rel="stylesheet" href="css/global.css" type="text/css" media="screen" />


<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/init.js"></script>
</head>
<body>
<!-- 店铺设置 -->
<div id="main">
<script id="basicSet" type="text/html">
<header class="common-header">
	<div class="top_fixed">
		<a class="top_icon go_back mui-action-back" href="javascript:;"></a>
        <h1 class="top_title">基础设置</h1>
    </div>
</header>
<nav class="nav_view m_mt30">
	<div class="nav_view_item navigate_right" data-fullslide='show' data-target="#coverfull">
		<span class="item_title">餐具费用</span>
			<div class="item_content">
				<p class="tr f_999" id="showCover">
					{{if vendorBasic.coverPrice == 0}}
						未设置
					{{else}}
						{{vendorBasic.coverPrice}}元/人
					{{/if}}
				</p>
			</div>
	</div>
	<div class="nav_view_item navigate_right" data-fullslide='show' data-target="#integralfull">
		<span class="item_title">积分换算</span>
			<div class="item_content">
				<p class="tr f_999" id="showIntegral">
					{{if vendorInfo.integralNum == 0}}
						未设置
					{{else}}
						{{vendorInfo.integralNum}}积分抵扣一元
					{{/if}}
				</p>
			</div>
	</div>
	<div class="nav_view_item navigate_right" data-fullslide='show' data-target="#appraiseintergralfull">
		<span class="item_title">评论赠积分</span>
			<div class="item_content">
				<p class="tr f_999" id="showAppraiseIntergral">
					{{if vendorInfo.appraiseIntegral == 0}}
						未设置
					{{else}}
						评论赠{{vendorInfo.appraiseIntegral}}积分
					{{/if}}
				</p>
			</div>
	</div>
</nav><!-- 店铺设置 end -->
</script>
</div>
<!-- 全屏侧滑 积分换算 -->
<section class="full_slide" id="integralfull">
	<header class="common-header">
		<div class="top_fixed">
			<span class="top_icon go_back" data-fullslide='miss'></span>
	        <h1 class="top_title">积分换算</h1>
	    </div>
	</header>
	
	<nav class="nav_view m_mt30">
		<div class="nav_view_item">
			<span class="item_title">积分换算</span>
			<div class="item_content">
				<input type="text" name="integralNum" id="integralNum"  class="form-control" placeholder="请输入积分数"> 
			</div>
		</div>
		<p class="f_ccc fz20 m_mb10 m_plr4">设置1元等于多少积分，积分数必须是非负整数</p>
	</nav>
	
	<!-- 保存按钮 -->
	<nav class="edit_btn2">
		<a href="javascript:saveIntegral()" class="btn btn-white">保存</a>
	</nav>
</section>
<!-- 全屏侧滑 积分换算 end -->


<!-- 全屏侧滑 餐具费用 -->
<section class="full_slide" id="coverfull">
	<header class="common-header">
		<div class="top_fixed">
			<span class="top_icon go_back" data-fullslide='miss'></span>
	        <h1 class="top_title">餐具费用</h1>
	    </div>
	</header>
	
	<nav class="nav_view m_mt30">
		<div class="nav_view_item">
			<span class="item_title">餐具费用</span>
			<div class="item_content">
				<input type="text" id="coverPrice"  class="form-control" placeholder="请输入餐具费用"> 
				<label class="edit_unit">元/人</label>
			</div>
		</div>
		<p class="f_ccc fz20 m_mb10 m_plr4">餐具费用必须是正数,并且最多保留两位小数</p>
	</nav>
	
	<!-- 保存按钮 -->
	<nav class="edit_btn2">
		<a href="javascript:saveCover()" class="btn btn-white">保存</a>
	</nav>
</section>
<!-- 全屏侧滑 餐具费用 end -->

<!-- 全屏侧滑 评论送积分换算 -->
<section class="full_slide" id="appraiseintergralfull">
	<header class="common-header">
		<div class="top_fixed">
			<span class="top_icon go_back" data-fullslide='miss'></span>
	        <h1 class="top_title">评论赠积分</h1>
	    </div>
	</header>
	
	<nav class="nav_view m_mt30">
		<div class="nav_view_item">
			<span class="item_title">赠送积分</span>
			<div class="item_content">
				<input type="text" name="appraiseIntegral" id="appraiseIntegral"  class="form-control" placeholder="请输入积分数"> 
			</div>
		</div>
		<p class="f_ccc fz20 m_mb10 m_plr4">积分数必须是非负整数</p>
	</nav>
	
	<!-- 保存按钮 -->
	<nav class="edit_btn2">
		<a href="javascript:saveAppraiseIntegral()" class="btn btn-white">保存</a>
	</nav>
</section>
<!-- 全屏侧滑 积分换算 end -->


<script src="js/mui.min.js"></script>
<!-- 接口调用公共插件 -->
<script src="js/validate.js"></script>
<script src="js/base.js"></script>
<script src="js/main.js"></script>
<script src="js/template.js"></script>
<script src="js/wapImageUploadForOrderEvaluation.js"></script>

<script type="text/javascript">
	$(function(){
	    //获取商户信息
		var accessToken = sessionObtain('accessToken');
        var userId =  sessionObtain('userId');
		var deviceId = sessionObtain('deviceId');
		var vendorId = sessionObtain('vendorId');
		var methodName = "userfront/vendor/get/" + vendorId;
	    var params = {"accessToken":accessToken,"userId":userId,"deviceId":deviceId};
		$.ax(
			methodName,
			params,
			false,
			"post",
			"json", 
			function(data){
				if (1 == data.returnCode) {
					var htmlstr = template('basicSet', data.data.result);
					$("#main").html(htmlstr);
					$("#integralNum").val(data.data.result.vendorInfo.integralNum);
					$("#coverPrice").val(data.data.result.vendorBasic.coverPrice);
					$("#appraiseIntegral").val(data.data.result.vendorInfo.appraiseIntegral);
				}	
			}
		);
	})
	
	function saveIntegral() {
	   var accessToken = sessionObtain('accessToken');
       var userId =  sessionObtain('userId');
	   var deviceId = sessionObtain('deviceId');
	   var vendorId = sessionObtain('vendorId');
	   var integralNum = $("#integralNum").val();
	   if (!validateEmpty(integralNum)) {
		   integralNum = 0;
	   }
	   if (!validateIntegerAndZero(integralNum)) {
		   mui.alert("积分数必须是非负整数","提示");
		   return;
	   }
	   var methodName = "userfront/vendorinfo/updateVendorIntegral";
	   var params = {"accessToken":accessToken,"userId":userId,"deviceId":deviceId,"vendorId":vendorId,"integralNum":integralNum};
		$.ax(
		methodName,
		params,
		false,
		"post",
		"json", 
		function(data){
			if (1 == data.returnCode) {
				if(integralNum > 0){
					$("#showIntegral").html(integralNum+"积分换算一元");
				}else{
					$("#showIntegral").html("未设置");
				}
				fullslide_hide("#integralfull");
			}
		}
	 );
	}
	
	
	function saveCover() {
	   var accessToken = sessionObtain('accessToken');
       var userId =  sessionObtain('userId');
	   var deviceId = sessionObtain('deviceId');
	   var vendorId = sessionObtain('vendorId');
	   var coverPrice = $("#coverPrice").val();
	   if (!validateEmpty(coverPrice)) {
		   coverPrice = 0;
	   }
	   if (!validateFloatAndZero(coverPrice)) {
		   mui.alert("餐具费用必须是正数或最多两位小数","提示");
		   return;
	   }
	   var methodName = "userfront/vendorbasic/updateCoverPrice";
	   var params = {"accessToken":accessToken,"userId":userId,"deviceId":deviceId,"vendorId":vendorId,"coverPrice":coverPrice};
		$.ax(
		methodName,
		params,
		false,
		"post",
		"json", 
		function(data){
			if (1 == data.returnCode) {
				if(coverPrice > 0){
					$("#showCover").html(coverPrice+"元/人");
				}else{
					$("#showCover").html("未设置");
				}
				fullslide_hide("#coverfull");
			}
		}
	 );
	}
	
	function saveAppraiseIntegral() {
		   var accessToken = sessionObtain('accessToken');
	       var userId =  sessionObtain('userId');
		   var deviceId = sessionObtain('deviceId');
		   var vendorId = sessionObtain('vendorId');
		   var appraiseIntegral = $("#appraiseIntegral").val();
		   if (!validateEmpty(appraiseIntegral)) {
			   appraiseIntegral = 0;
		   }
		   if (!validateIntegerAndZero(appraiseIntegral)) {
			   mui.alert("积分必须是非负整数","提示");
			   return;
		   }
		   var methodName = "userfront/vendorinfo/updateAppraiseIntegral";
		   var params = {"accessToken":accessToken,"userId":userId,"deviceId":deviceId,"vendorId":vendorId,"appraiseIntegral":appraiseIntegral};
			$.ax(
			methodName,
			params,
			false,
			"post",
			"json", 
			function(data){
				if (1 == data.returnCode) {
					if(appraiseIntegral > 0){
						$("#showAppraiseIntergral").html("评论赠"+appraiseIntegral+"积分");
					}else{
						$("#showAppraiseIntergral").html("未设置");
					}
					fullslide_hide("#appraiseintergralfull");
				}
			}
		 );
	}
</script>
</body>
</html>